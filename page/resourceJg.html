<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>资源加工</title>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_1492202_ne7g262sz6.css">
    <link rel="stylesheet" href="../css/layui.css"/>
    <link rel="stylesheet" href="../css/common.css"/>
    <style>
        body{
            overflow: hidden;
        }
        .table-content{
            padding: 0 50px;
        }
        .layui-form-item{
            margin-bottom: 0px;
        }
        .dFlex{
            display: flex;
        }
        .dFlex .flexOne{
            flex: 1;
        }
        .dFlex .flexOne .layui-input-inline{
            margin-bottom: 12px;
        }
        .search-div{
            position: relative;
            background: #fff;
            padding: 8px;
        }
        .tableDiv{
            background: #fff;
            padding: 0 8px;
        }
        .search-btn{
            text-align: center;
            position: absolute;
            width: 25%;
            bottom: 8px;
            right: 0;
        }
        .table-cz-btn{
            margin: 0 3px;
        }
        .iconarrow-double-up-class i,.iconarrow-double-down i{
            font-size: 20px;
            color: #999;
            vertical-align: middle;
            margin-right: 6px;
        }
        .iconarrow-double-down-class{
            display: none;
        }
        .layui-table-view,.layui-table{
            margin: 0;
        }
        .cz-btn{
            text-align: left;
            margin-top: 10px;
            background: #fff;
            padding: 6px 10px;
        }
        .cz-btn button.layui-btn{
            height: 30px;
            line-height: 30px;
            padding: 0 14px;
        }
    </style>
</head>
<body>
<div class="layui-tab-item layui-show">
    <div class="table-content ">
        <form class="layui-form layui-row" action="">
        <div class="search-div layui-row">
            <div class="layui-col-md9 layui-col-space10">
                    <div class="layui-col-md4">
                        <div class="layui-form-item">
                            <label class="layui-form-label">资源名称</label>
                            <div class="layui-input-block">
                                <input type="text" name="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md4">
                        <div class="layui-form-item">
                            <label class="layui-form-label">资料格式</label>
                            <div class="layui-input-block">
                                <select name="interest" lay-filter="format">
                                    <option value=""></option>
                                    <option value="0">格式1</option>
                                    <option value="1" selected="">格式2</option>
                                    <option value="2">格式3</option>
                                    <option value="3">格式4</option>
                                    <option value="4">格式5</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md4">
                        <div class="layui-form-item">
                            <label class="layui-form-label">资料分类</label>
                            <div class="layui-input-block">
                                <select name="interest" lay-filter="type">
                                    <option value=""></option>
                                    <option value="0">分类1</option>
                                    <option value="1" selected="">分类2</option>
                                    <option value="2">分类3</option>
                                    <option value="3">分类4</option>
                                    <option value="4">分类5</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-space10 clearfix form-hide">
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">入库人</label>
                                <div class="layui-input-block">
                                    <select name="interest" lay-filter="agent">
                                        <option value=""></option>
                                        <option value="0">入库人1</option>
                                        <option value="1" selected="">入库人2</option>
                                        <option value="2">入库人3</option>
                                        <option value="3">入库人4</option>
                                        <option value="4">入库人5</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">入库时间</label>
                                <div class="layui-input-block">
                                    <input type="text" name="date" placeholder="请选择上架时间" id="date1" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">是否出版</label>
                                <div class="layui-input-block">
                                    <select name="interest" lay-filter="examineState">
                                        <option value="">请选择</option>
                                        <option value="0" selected="">是</option>
                                        <option value="1">否</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">标引人</label>
                                <div class="layui-input-block">
                                    <input type="text" placeholder="请输入标引人名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">标引时间</label>
                                <div class="layui-input-block">
                                    <input type="text" name="date2" placeholder="请选择标引时间" id="date2" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md4">
                            <div class="layui-form-item">
                                <label class="layui-form-label">审核状态</label>
                                <div class="layui-input-block">
                                    <select name="interest" lay-filter="examineState">
                                        <option value=""></option>
                                        <option value="0">状态1</option>
                                        <option value="1" selected="">状态2</option>
                                        <option value="2">状态3</option>
                                        <option value="3">状态4</option>
                                        <option value="4">状态5</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-md12">
                            <div class="layui-form-item dFlex">
                                <label class="layui-form-label">教育属性</label>
                                <div class="layui-row flexOne layui-col-space10">
                                    <div class="layui-col-md3">
                                        <select name="quiz1">
                                            <option value="">请选择学段</option>
                                            <option value="1" selected="">学段1</option>
                                            <option value="2">学段2</option>
                                            <option value="3">学段3</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz2">
                                            <option value="">请选择科学</option>
                                            <option value="1">科学1</option>
                                            <option value="2" disabled="">科学2</option>
                                            <option value="3">科学3</option>
                                            <option value="4">科学4</option>
                                            <option value="5">科学5</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz3">
                                            <option value="">请选择版本</option>
                                            <option value="1">版本1</option>
                                            <option value="2">版本2</option>
                                            <option value="3">版本3</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz4">
                                            <option value="">请选择年级</option>
                                            <option value="1">年级1</option>
                                            <option value="2">年级2</option>
                                            <option value="3">年级3</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz5">
                                            <option value="">请选择册名</option>
                                            <option value="1">册名1</option>
                                            <option value="2">册名2</option>
                                            <option value="3">册名3</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz6">
                                            <option value="">请选择教材章节</option>
                                            <option value="1">教材章节1</option>
                                            <option value="2">教材章节2</option>
                                            <option value="3">教材章节3</option>
                                        </select>
                                    </div>
                                    <div class="layui-col-md3">
                                        <select name="quiz7">
                                            <option value="">请选择知识点</option>
                                            <option value="1">知识点1</option>
                                            <option value="2">知识点2</option>
                                            <option value="3">知识点3</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="search-btn layui-col-md3">
                <a href="javascript:void(0);" class="iconarrow-double-up-class"><i class="iconfont iconarrow-double-up"></i></a>
                <a href="javascript:void(0);" class="iconarrow-double-down-class"><i class="iconfont iconarrow-double-down"></i></a>
                <button type="submit" class="layui-btn layui-btn-normal" lay-submit="" lay-filter="demo1">查询</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
        </form>
        <div class="tableDiv">
            <div class="cz-btn">
                <button type="button" class="layui-btn layui-btn-normal" id="by-btn">标引</button>
                <button type="button" class="layui-btn layui-btn-primary">查重</button>
                <button type="button" class="layui-btn layui-btn-primary" id="sc-btn">删除</button>
                <button type="button" class="layui-btn layui-btn-primary">出版</button>
            </div>
            <table id="layui-table" lay-filter="tableBox"  class="layui-table"></table>
        </div>
    </div>
</div>
<script src="../layui.all.js" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-1.4.4.min.js" type="text/javascript"></script>
<script type="text/html" id="barDemo">
    <a class="table-cz-btn" lay-event="select" onclick="toDetail()">
        <i class="iconfont iconxiangqing" title="详情" style="color: #51B4E4;font-size: 18px;vertical-align: middle"></i>
    </a>
    <a class="table-cz-btn" lay-event="select">
        <i class="iconfont iconyulan" title="预览" style="color: #51B4E4;font-size: 18px;vertical-align: middle"></i>
    </a>
</script>
<script>
    layui.use(['jquery', 'layer'], function(){
        var $ = layui.jquery //重点处
            ,form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,element = layui.element
            ,table = layui.table  //表格，注意此处table必须是全局变量
            ,laydate = layui.laydate;
        //日期选择
        laydate.render({
            elem: '#date1'
            ,range:true
        });
        laydate.render({
            elem: '#date2'
            ,range:true
        });
        //表格参数
        var arr = [[
            {type:'checkbox'}
            ,{field: 'id', title: '序号',width:60}
            ,{field: 'name', title: '资源名称'}
            ,{field: 'status3', title: '资源分类'}
            ,{field: 'ylwl', title: '资源格式'}
            ,{field: 'ssyy', title: '教育属性'}
            ,{field: 'ssyy', title: '入库人'}
            ,{field: 'time', title: '入库时间'}
            ,{field: 'ylwl', title: '标引人'}
            ,{field: 'ylwl', title: '标引时间'}
            ,{field: 'ylwl', title: '是否出版'}
            ,{field: 'ssyy', title: '审核状态'}
            ,{fixed: 'right', title:'操作', width:150, align:'center', toolbar: '#barDemo'} //这里的toolbar值是模板元素的选择器
        ]];
        var limitArr =[10,20,30];
        var urls = '../tableJson.js';
        com.tableRender('#layui-table','tableId','full-53',limitArr,urls,arr);//加载表格,注意tableId是自定义的，在表格重载需要！！
        //复选方法监听    自定义数组
        var ids = null;
        var flag = true
        table.on('checkbox(tableBox)', function(obj){
            if (flag){
                ids = $(".layui-laypage-limits").find("option:selected").val()
                flag = false
            }
            if(obj.checked==true){
                if(obj.type=='all'){
                    ids = $(".layui-laypage-limits").find("option:selected").val()
                    $("#by-btn").text("批量标引")
                    $("#sc-btn").text("批量删除")
                }else{
                    if (ids <= 0){
                        $("#by-btn").text("标引")
                        $("#sc-btn").text("删除")
                    } else{
                        $("#by-btn").text("批量标引")
                        $("#sc-btn").text("批量删除")
                    }
                    ids++
                }
            }else{
                if(obj.type=='all'){
                    ids = 0
                    $("#by-btn").text("标引")
                    $("#sc-btn").text("删除")
                }else{
                    ids--
                    console.log(ids)
                    if (ids >= 2){
                        $("#by-btn").text("批量标引")
                        $("#sc-btn").text("批量删除")
                    } else {
                        $("#by-btn").text("标引")
                        $("#sc-btn").text("删除")
                    }

                }
            }
        });
        getHeight()
        //标引
        $("#by-btn").click(function(){
            var checkStatus = table.checkStatus('tableId');
            if(checkStatus.data == null || checkStatus.data == ""){
                parent.layer.msg('请选择至少一个数据进行标引',{icon: 5,anim: 6,time:2000});
                return false;
            }
            var id = checkStatus.data[0].id;
            var index = parent.layer.open({
                type:2,
                title:'标引',
                resize:false,//禁止拉伸
                area: ['80%', '78%'], //宽高
                content: "./page/auditProcess/firstTria.html"
            });
            parent.index_  = index;//传给子页面的值index
            parent.id_ = checkStatus.data[0].id;//传给子页面的数据id！！！！
        })
        //伸缩箭头
        $("body").on("click",'.iconarrow-double-up-class',function () {
            $(".form-hide").hide()
            $(this).hide()
            $(".iconarrow-double-down-class").show()
            getHeight()
        })
        $("body").on("click",'.iconarrow-double-down-class',function () {
            $(".form-hide").show()
            $(this).hide()
            $(".iconarrow-double-up-class").show()
            getHeight()
        })
        $(window).resize(function () {
            getHeight()
        })
    });
    function toDetail(){
        com.openMore("详情","./page/detail/detail.html",['80%', '80%'],"tableId");
    }
    //页面高度适配
    function getHeight() {
        $(".tableDiv .layui-table-view").height($(window).height()-72-$(".search-div").height());//表格高度
        $(".tableDiv .layui-table-view .layui-table-box").height($(window).height()-114-$(".search-div").height());//表格高度
        $(".tableDiv .layui-table-view .layui-table-body").height($(window).height()-150-$(".search-div").height());//表格高度
    }
</script>
</body>
</html>
